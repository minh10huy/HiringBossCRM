/*********************************************************************************
 * This file is part of KReporter. KReporter is an enhancement developed
 * by Christian Knoll. All rights are (c) 2012 by Christian Knoll
 *
 * This Version of the KReporter is licensed software and may only be used in
 * alignment with the License Agreement received with this Software.
 * This Software is copyrighted and may not be further distributed without
 * witten consent of Christian Knoll
 *
 * You can contact Christian Knoll at info@kreporter.org
 *
 ********************************************************************************/
var L=[{name:'fieldid',mapping:'fieldid'},{name:'sequence',mapping:'sequence'},{name:'name',mapping:'name'},{name:'display',mapping:'display'},{name:'path',mapping:'path'},{name:'displaypath',mapping:'displaypath'},{name:'sort',mapping:'sort'},{name:'sortpriority',mapping:'sortpriority'},{name:'width',mapping:'width'},{name:'jointype',mapping:'jointype'},{name:'groupby',mapping:'groupby'}];var A=new Ext.data.JsonStore({fields:L});var FieldsArray;eval('FieldsArray = '+document.getElementById('listfieldarray').value+';');var store=new Ext.data.Store({id:'store',reCount:false,whereConditions:null,proxy:new Ext.data.HttpProxy({url:'index.php?module=KReports&action=load_report&to_pdf=true',method:'POST'}),baseParams:{requester:document.getElementById('recordid').value},reader:new Ext.data.JsonReader({root:'records',totalProperty:'count'},FieldsArray),remoteSort:true});store.on('load',function(){if(store.reCount==true){standardViewGetReportCount();store.reCount=false;}});var standardViewCountHandling='Synchronous';var standardViewListCount=25;function renderReport(){var ColumnsArray;eval('ColumnsArray = '+document.getElementById('columnmodeldarray').value+';');if(document.getElementById('listtypeproperties').value!=''){listTypeProperties=Ext.util.JSON.decode(document.getElementById('listtypeproperties').value);standardViewCountHandling=listTypeProperties[0].counthandling;if(listTypeProperties[1].listcount!=undefined&&listTypeProperties[1].listcount>0)standardViewListCount=listTypeProperties[1].listcount;}switch(standardViewCountHandling){case 'None':case 'Asynchronous':pagingToolBarDisplayMsg="Displaying Records {0} - {1}";store.setBaseParam('doCount',false);break;case 'Synchronous':pagingToolBarDisplayMsg="Displaying Records {0} - {1} of {2}";store.setBaseParam('doCount',true);break;}if(document.getElementById('reportoptions').value!='')reportOptionsObject=Ext.util.JSON.decode(document.getElementById('reportoptions').value);else reportOptionsObject=new Object();if(reportOptionsObject.resultsFolded!=undefined&&reportOptionsObject.resultsFolded==true)resultsFolded=true;else resultsFolded=false;var KINAMUautoHeightGridView=Ext.extend(Ext.grid.GridView,{onLayout:function(){Ext.get(this.innerHd).setStyle("float","none");this.scroller.setStyle("overflow-x","auto");}});if(Ext.isIE==true){var grid=new Ext.grid.GridPanel({id:'detailViewGrid',store:store,columns:ColumnsArray,monitorResize:true,height:600,boxMinHeight:250,width:document.getElementById("reportMain").offsetWidth,renderTo:'reportGrid',view:new KINAMUautoHeightGridView(),bbar:new Ext.PagingToolbar({store:store,displayInfo:true,pageSize:standardViewListCount,displayMsg:pagingToolBarDisplayMsg,buttons:['-',{id:'KReportsLayoutSaveButton',disabled:true,icon:'modules/KReports/images/layoutsave.png',handler:function(){varcolArray=new Array();for(i=0;i<grid.getColumnModel().getColumnCount();i++){varcolArray[i]=new Object();varcolArray[i].sequence=i+1;varcolArray[i].dataIndex=grid.getColumnModel().getDataIndex(i);varcolArray[i].width=grid.getColumnModel().getColumnWidth(i);varcolArray[i].isHidden=grid.getColumnModel().isHidden(i);}Ext.Ajax.request({url:'index.php?module=KReports&to_pdf=true&action=save_standard_layout',params:{record:document.getElementById('recordid').value,layoutparams:Ext.util.JSON.encode(varcolArray)}});}}]}),title:l('LBL_STANDARDGRIDPANELTITLE'),collapsible:true,collapsed:resultsFolded,listeners:{'viewready':function(){this.setHeight();}}});var resizeGrid=function(resizer,width,height){grid.setSize(width,height);};var resizer=new Ext.Resizable('reportGrid',{handles:'s',minWidth:200,minHeight:100,maxWidth:500,maxHeight:630,pinned:true});resizer.on('resize',resizeGrid);}else{var grid=new Ext.grid.GridPanel({id:'detailViewGrid',store:store,columns:ColumnsArray,monitorResize:true,autoHeight:true,boxMinHeight:250,width:document.getElementById("reportMain").offsetWidth,renderTo:'reportGrid',view:new KINAMUautoHeightGridView(),bbar:new Ext.PagingToolbar({store:store,displayInfo:true,pageSize:standardViewListCount,displayMsg:pagingToolBarDisplayMsg,buttons:['-',{id:'KReportsLayoutSaveButton',disabled:true,icon:'modules/KReports/images/layoutsave.png',handler:function(){varcolArray=new Array();for(i=0;i<grid.getColumnModel().getColumnCount();i++){varcolArray[i]=new Object();varcolArray[i].sequence=i+1;varcolArray[i].dataIndex=grid.getColumnModel().getDataIndex(i);varcolArray[i].width=grid.getColumnModel().getColumnWidth(i);varcolArray[i].isHidden=grid.getColumnModel().isHidden(i);}Ext.Ajax.request({url:'index.php?module=KReports&to_pdf=true&action=save_standard_layout',params:{record:document.getElementById('recordid').value,layoutparams:Ext.util.JSON.encode(varcolArray)}});}}]}),title:l('LBL_STANDARDGRIDPANELTITLE'),collapsible:true,collapsed:resultsFolded,listeners:{'viewready':function(){this.setHeight();}}});}var getListGridDetailsArray=function(){varcolArray=new Array();for(i=0;i<grid.getColumnModel().getColumnCount();i++){varcolArray[i]=new Object();varcolArray[i].sequence=i+1;varcolArray[i].dataIndex=grid.getColumnModel().getDataIndex(i);varcolArray[i].width=grid.getColumnModel().getColumnWidth(i);varcolArray[i].isHidden=grid.getColumnModel().isHidden(i);}alert(Ext.util.JSON.encode(varcolArray));};var storeLoadMask=new Ext.LoadMask('detailViewGrid',{store:store});storeLoadMask.enable();if(standardViewCountHandling!='Synchronous'&&standardViewCountHandling!='None')store.reCount=true;store.load({params:{start:0,limit:standardViewListCount}});};function standardViewGetReportCount(){Ext.Ajax.request({url:'index.php?module=KReports&action=load_report_count&to_pdf=true',success:function(result){Ext.getCmp('detailViewGrid').setTitle(l('LBL_STANDARDGRIDPANELTITLE')+' ('+result.responseText+' records found)');store.totalLength=80;},params:{requester:document.getElementById('recordid').value,whereConditions:store.whereConditions}});};function getGridColumns(){varcolArray=new Array();for(i=0;i<Ext.getCmp('detailViewGrid').getColumnModel().getColumnCount();i++){varcolArray[i]=new Object();varcolArray[i].sequence=i+1;varcolArray[i].dataIndex=Ext.getCmp('detailViewGrid').getColumnModel().getDataIndex(i);varcolArray[i].width=Ext.getCmp('detailViewGrid').getColumnModel().getColumnWidth(i);varcolArray[i].isHidden=Ext.getCmp('detailViewGrid').getColumnModel().isHidden(i);}return Ext.util.JSON.encode(varcolArray);};function reloadReportStore(whereConditions){store.removeAll();store.setBaseParam('whereConditions',whereConditions);if(standardViewCountHandling!='Synchronous'&&standardViewCountHandling!='None'){store.whereConditions=whereConditions;store.reCount=true;}store.load({params:{start:0,limit:standardViewListCount}});}